<html>
　

<head>
    　<title>countryList</title>
    <script src="jquery-3.6.0.min.js"></script>
    　<style>
        .flag {
            width: 20px;
        }

        .page {
            text-align: right;
        }

        table td {
            border: 1px #000 solid;
        }
    </style>
    <script>
        limit = 25;
        // sorting = 'ASC';

        countryList = new Array();
        $.ajax({
            url: "https://restcountries.eu/rest/v2/all",
            success: function (result) {
                countryList = result;
                fillTable(1, limit);
                totalItem = countryList.length;
                createPagination(1, totalItem, limit);
            }
        });

        function fillTable(page, limit) {
            cleanTable();
            startWith = (page - 1) * limit;

            for (i = startWith; i < startWith + limit; i++) {
                item = countryList[i];
                strHtml = '<tr>';
                strHtml += '<td>' + (i + 1) + '</td>';
                strHtml += fillTd(item, 'flag');
                strHtml += fillTd(item, 'name');
                strHtml += fillTd(item, 'alpha2Code');
                strHtml += fillTd(item, 'alpha3Code');
                strHtml += fillTd(item, 'nativeName');
                strHtml += fillTd(item, 'altSpellings');
                strHtml += fillTd(item, 'callingCodes');
                strHtml += '<td>more</td>';
                strHtml += '</tr>';

                $('#itemList').append(strHtml);
            }
        }

        function fillTd(item, field) {
            tmpHtml = '<td>';
            switch (field) {
                case 'flag':
                    tmpHtml += '<img class="flag" src="' + item.flag + '" alt="' + item.name + '" >';
                    break;
                default:
                    tmpHtml += item[field];
            }
            tmpHtml += '</td>';
            return tmpHtml;
        }

        function cleanTable() {
            $('#itemList').html("");
        }

        function createPagination(now, totalItem, limit) {
            totalPage = Math.round(totalItem / limit);

            tmpHtml = '<tr><td colspan="9" class="page">';
            for (let index = 1; index <= totalPage; index++) {
                if (index === now) {
                    tmpHtml += index + '&nbsp;';
                } else {
                    tmpHtml += '<a href="#" onclick="changePage(' + index + ')">' + index + '</a>' + '&nbsp;';
                }
            }
            tmpHtml += '</td></tr>';
            $('#listPage').html(tmpHtml);
        }

        function changePage(to) {
            fillTable(to, limit);
            totalItem = countryList.length;
            createPagination(to, totalItem, limit);
        }

        //TODO 反向獲取數據可能性能更好？
        function changeSorting() {
            countryList = countryList.reverse();
            fillTable(1, limit);
            totalItem = countryList.length;
            createPagination(1, totalItem, limit);

            // if (sorting === 'ASC') {
            //     sorting = 'DESC';
            // } else {
            //     sorting = 'ASC';
            // }
        }
    </script>
</head>
　

<body>
    <table id="countryList">
        <thead>
            <th>
                no
            </th>
            <th>
                flag
            </th>
            <th>
                <a href="#" onclick="changeSorting()">name</a>
            </th>
            <th>
                alpha2Code
            </th>
            <th>
                alpha3Code
            </th>
            <th>
                nativeName
            </th>
            <th>
                altSpellings
            </th>
            <th>
                callingCodes
            </th>
            <th>
                model
            </th>
        </thead>
        <tbody id="itemList">

        </tbody>
        <tfoot id="listPage">

        </tfoot>
    </table>
</body>

</html>